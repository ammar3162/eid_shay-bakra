<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù†ØµØ© Ø§Ù„ØªÙ‡Ù†Ø¦Ø© Ø§Ù„Ø°ÙƒÙŠØ© | Ø§Ù†Ø´Ø± Ø§Ù„ÙØ±Ø­ ğŸ</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Cairo:wght@600;800&display=swap" rel="stylesheet">

<style>
:root{
--primary:#e53e3e;
--dark:#2d3748;
--whatsapp:#25D366;
--bg:linear-gradient(135deg,#f6f8fb 0%,#e2e8f0 100%);
}

body{
font-family:'Cairo',sans-serif;
background:var(--bg);
margin:0;
display:flex;
align-items:center;
justify-content:center;
min-height:100vh;
padding:20px;
}

.modal-overlay{
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:rgba(0,0,0,.85);
display:flex;
align-items:center;
justify-content:center;
z-index:2000;
backdrop-filter:blur(10px);
}

.modal-content{
background:white;
padding:40px 30px;
border-radius:30px;
max-width:400px;
width:85%;
text-align:center;
box-shadow:0 25px 50px -12px rgba(0,0,0,.5);
animation:pop .6s cubic-bezier(.175,.885,.32,1.275);
}

@keyframes pop{
from{transform:translateY(20px) scale(.9);opacity:0}
to{transform:translateY(0) scale(1);opacity:1}
}

.main-wrapper{
background:white;
padding:25px;
border-radius:30px;
box-shadow:0 20px 25px -5px rgba(0,0,0,.1);
width:100%;
max-width:450px;
text-align:center;
}

.joy-badge{
background:#fff5f5;
color:var(--primary);
padding:10px 20px;
border-radius:50px;
font-size:14px;
font-weight:800;
display:inline-flex;
margin-bottom:20px;
border:2px solid #fed7d7;
animation:pulse 2s infinite;
}

@keyframes pulse{
0%{transform:scale(1)}
50%{transform:scale(1.05)}
100%{transform:scale(1)}
}

#capture-area{
position:relative;
width:100%;
border-radius:20px;
overflow:hidden;
margin-bottom:25px;
}

#template-img{
width:100%;
display:block;
}

#display-name{
position:absolute;
bottom:20%;
left:50%;
transform:translateX(-50%);
width:85%;
font-family:'Amiri',serif;
font-size:clamp(26px,6vw,42px);
color:#fff8e4;
text-shadow:0 2px 10px rgba(0,0,0,.4);
text-align:center;
white-space:nowrap;
overflow:hidden;
text-overflow:ellipsis;
transition:.3s ease;
}

.action-btns{
display:flex;
flex-direction:column;
gap:12px;
}

input{
padding:18px;
border:2px solid #e2e8f0;
border-radius:15px;
font-size:18px;
text-align:center;
background:#f8fafc;
}

input:focus{
border-color:var(--primary);
outline:none;
background:#fff;
}

.btn{
padding:18px;
border:none;
border-radius:15px;
font-weight:800;
font-size:17px;
cursor:pointer;
display:flex;
align-items:center;
justify-content:center;
gap:10px;
}

.btn-download{
background:var(--dark);
color:white;
}

.btn-share{
background:var(--whatsapp);
color:white;
display:none;
}

.footer-text{
font-size:12px;
color:#94a3b8;
margin-top:20px;
font-weight:600;
}

#countdown{
margin-top:15px;
font-weight:bold;
color:var(--primary);
}
</style>
</head>

<body>

<div class="modal-overlay" id="welcomeModal">
<div class="modal-content" id="modalContent">
<div style="font-size:50px;">ğŸ</div>
<h2>Ø¹ÙŠØ¯ÙŠØ© Ø®Ø§ØµØ©!</h2>
<p>
Ù‡Ø°Ù‡ Ù„ÙŠØ³Øª ØªÙ‡Ù†Ø¦Ø© Ø¹Ø§Ø¯ÙŠØ©...  
ÙƒÙ„ Ù…Ù† ØªØµÙ„Ù‡ Ø¨Ø·Ø§Ù‚ØªÙƒ Ø³ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ ÙØ±ØµØ© Ø¹ÙŠØ¯ÙŠØ©ØŒ  
ÙˆÙƒÙ„Ù…Ø§ Ù†Ø´Ø±Øª Ø£ÙƒØ«Ø± Ø²Ø§Ø¯Øª ÙØ±ØµØªÙƒ!
</p>
<button class="btn btn-download" style="width:100%" onclick="closeModal()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† âœ¨</button>
<div id="countdown"></div>
</div>
</div>

<div class="main-wrapper">

<div class="joy-badge">
â¤ï¸ ØªÙ… Ù†Ø´Ø± Ø§Ù„ÙØ±Ø­ Ù„Ù€ <span id="joy-count">...</span> Ø´Ø®Øµ
</div>

<div id="capture-area">
<img id="template-img" src="eid_koshary.jpg">
<div id="display-name">Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§</div>
</div>

<div class="action-btns">
<input type="text" id="nameInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…..." maxlength="25" oninput="updateUI()">

<button id="downloadBtn" class="btn btn-download" onclick="handleDownload()">
ğŸ¨ ØµÙ…Ù… ÙˆØ­Ù…Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
</button>

<button id="shareBtn" class="btn btn-share" onclick="handleShare()">
ğŸ“² Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
</button>
</div>

<div class="footer-text">ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ… Ø¨Ø®ÙŠØ± Ø´Ø§ÙŠ Ø¨ÙƒØ±Ù‡ Â© 2026</div>

</div>

<script>

const SCRIPT_URL='https://script.google.com/macros/s/AKfycbxnW-kXF76t-bWQrI-SiKHjxeKYK1HIzIa1xMXgVzgMspNQx3FgPJ99RHaXdV9FIi1NNQ/exec';
let generatedBlob=null;

/* ===== Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø© ===== */
const params=new URLSearchParams(window.location.search);
const ref=params.get("ref");

if(ref){
document.getElementById("modalContent").innerHTML=`
<div style="font-size:50px;">ğŸ‰</div>
<h2>ÙˆØµÙ„ØªÙƒ ØªÙ‡Ù†Ø¦Ø© Ù…Ù† ${ref}</h2>
<p>Ø§ÙØªØ­ Ø¨Ø·Ø§Ù‚ØªÙƒ Ø§Ù„Ø¢Ù† ÙˆØ±Ø¨Ù…Ø§ ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø¹ÙŠØ¯ÙŠØ© ğŸ</p>
<button class="btn btn-download" style="width:100%" onclick="closeModal()">Ø§ÙØªØ­ Ø§Ù„Ø¢Ù†</button>
`;
}

/* ===== Ù…Ø¤Ù‚Øª ===== */
function startCountdown(){
let time=1800;
setInterval(()=>{
let m=Math.floor(time/60);
let s=time%60;
document.getElementById("countdown").innerText=
`â³ Ø§Ù„Ø¹ÙŠØ¯ÙŠØ© Ù…ØªØ§Ø­Ø© Ù„Ù…Ø¯Ø© ${m}:${s<10?'0'+s:s}`;
if(time>0)time--;
},1000);
}
startCountdown();

/* ===== Ø¹Ø¯Ø§Ø¯ Ù…ØªØ­Ø±Ùƒ ===== */
function animateCounter(target){
let current=0;
const inc=target/50;
const int=setInterval(()=>{
current+=inc;
if(current>=target){
current=target;
clearInterval(int);
}
document.getElementById("joy-count").innerText=
Math.floor(current).toLocaleString('ar-SA');
},20);
}

/* Ù…Ø«Ø§Ù„ Ø±Ù‚Ù… Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ */
animateCounter(1291);

/* ===== ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… ===== */
function updateUI(){
const input=document.getElementById("nameInput").value;
const el=document.getElementById("display-name");
el.style.opacity=0;
setTimeout(()=>{
el.innerText=input||"Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§";
el.style.opacity=1;
},150);
}

/* ===== Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ===== */
function closeModal(){
document.getElementById("welcomeModal").style.display="none";
}

/* ===== ØªØ­Ù…ÙŠÙ„ ===== */
async function handleDownload(){
const name=document.getElementById("nameInput").value;
if(!name.trim()){
alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹ â¤ï¸");
return;
}

const canvas=await html2canvas(document.getElementById("capture-area"),{
scale:3,
backgroundColor:null
});

canvas.toBlob(blob=>{
generatedBlob=blob;
const url=URL.createObjectURL(blob);
const link=document.createElement("a");
link.download=`Ø¹ÙŠØ¯_Ù…Ø¨Ø§Ø±Ùƒ_${name}.png`;
link.href=url;
link.click();
document.getElementById("shareBtn").style.display="flex";
},'image/png',1);
}

/* ===== Ù…Ø´Ø§Ø±ÙƒØ© ===== */
async function handleShare(){
if(!generatedBlob)return;

const name=document.getElementById("nameInput").value||"ØµØ¯ÙŠÙ‚Ùƒ";
const refLink=window.location.origin+window.location.pathname+"?ref="+encodeURIComponent(name);

const text=`Ø¹ÙŠØ¯Ùƒ Ù…Ø¨Ø§Ø±Ùƒ âœ¨
ÙˆØµÙ„ØªÙƒ ØªÙ‡Ù†Ø¦Ø© Ø¨Ø§Ø³Ù…ÙŠ ğŸ

Ø§ÙØªØ­ Ø¨Ø·Ø§Ù‚ØªÙƒ Ù‡Ù†Ø§:
${refLink}

Ø§ØµÙ†Ø¹ ØªÙ‡Ù†Ø¦ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© Ø§Ù„Ø¢Ù†:
${window.location.href}`;

const whatsappText=encodeURIComponent(text);
window.open(`https://wa.me/?text=${whatsappText}`,'_blank');
}

</script>

</body>
</html>
